<%
my = @mytemplate

if my.subcategory != nil
	category_info = Category.get(my.category.to_i).name + "/" + Subcategory.get(my.subcategory.to_i).name
	sn_num = my.category  + "-" + my.subcategory + "-" + my.id.to_s
else
	category_info = Category.get(my.category.to_i).name	
	sn_num = my.category  + "-" + my.id.to_s
end
%>
<script language="javascript">
function del_mytemp(id){
	if (window.confirm("정말 삭제하시겠습니까?")){
		loadingView();
		$.ajax({
			data:'id='+ id, 
			dataType:'script', 
			type:'post', 
			url:'/mytemplates/destroy',
			success: function(request){
				loadingView();
				document.location.replace('/mytemplates');

			}
		});	
	};
}
</script>
<script language="javascript">
$(document).ready(function(){
	$('#req_submit').click(function(){
		if ($('#feedback_memo').val() == ""){
			alert("요청사항을 입력해주세요~");
		}else{
			loadingView();
			$.ajax({
				data:'id=<%= my.id.to_s %>&content='+$('#feedback_memo').val()+'&feedback_code='+$('input:radio[name=feedback_code]:checked').val(), 
				dataType:'script', 
				type:'post', 
				url:'/mytemplates/jobboard_create',
				success:function(request){
					loadingView();
					$('#feedback_memo').val("");
					$('#jbbs_body').html(request);
				}
			});
		}
		
	});
});
</script>

<div id="designcart-detail" class="content-layout">
	<h3>디자인바구니 <span><%=(my.job_code == 0)? "직접편집":"편집의뢰" %> - <%= category_info %> (<%= sn_num %>)</span></h3>
	<ul class="content-description">
		<li>편집한 다지안 품목의 내용을 자세히 확인하는 페이지입니다.</li>
		<li>편집에 어려움이 있는 경우 관리자에게 도움을 요청할 수 있습니다.</li>
	</ul>
	<a href="/mytemplates"><img src="/images/content/button-backlist-out.png" alt="목록으로 돌아가기" width="103" height="27" /></a>
	<!-- 미리보기의 가로가 길면 item-horizon, 세로가 길면 item-vertical -->
	<div id="item-information" class="### 가로, 세로 스타일명 ###">
		<h4>미리보기</h4>
		<img src="<%= my.preview_url %>" class="preview" width="580px">
		<div class="item-detail">
			<h4>상세내용</h4>
			<ul class="item-detail">
				<li class="type"><strong class="title">구분</strong><%=(my.job_code == 0)? "직접편집":"편집의뢰" %></li>
				<li class="item"><strong class="title">품목</strong><%= category_info %></li>
				<li class="designcode"><strong class="title">디자인번호</strong><%= sn_num %></li>
				<li class="size"><strong class="title">사이즈</strong><%= my.size %></li>
				<li class="date"><strong class="title">최종수정일</strong><%= my.updated_at.strftime('%Y-%m-%d') %></li>
				<li class="price"><strong class="title">개별금액</strong> 30,000원</li>
			</ul>
			<fieldset class="option-select_detail">
				<legend>옵션 선택</legend>
				<ul>
					<!-- 옵션 반복 시작 -->
					<li>
						<label>소재</label>
						<select name="### 옵션목록 이름 ###">
							<option value="" selected>선택해주세요.</option>
							<option value="">------------------</option>
							<!-- 옵션내용 반복 시작 -->
							<option value="그래픽천(현수막전용원단)">그래픽천(현수막전용원단)</option>
							<option value="페트(얇은플라스틱제질원단)">페트(얇은플라스틱제질원단)</option>
							<option value="합성지(점착가능원단)">합성지(점착가능원단)</option>
							<option value="PVC켈(점착가능원단)">PVC켈(점착가능원단)</option>
							<option value="부직포(어깨띠전용원단)">부직포(어깨띠전용원단)</option>
							<option value="폰지(디지털날염전용원단)">폰지(디지털날염전용원단)</option>
							<!-- 옵션내용 반복 끝 -->
						</select>
					</li>				
					<li>
						<label>후가공</label>
						<select name="select_sub_<%= my.id.to_s %>">
							<option value="" selected>선택해주세요.</option>
							<option value="">------------------</option>
							<!-- 옵션내용 반복 시작 -->
							<option value="열재단">열재단</option>
							<option value="사구아일렛">사구아일렛</option>
							<option value="막대가공">막대가공</option>
							<option value="봉미싱">봉미싱</option>
							<option value="끈고리">끈고리</option>
							<option value="사방줄미싱">사방줄미싱</option>
							<option value="큐방">큐방</option>
							<option value="기타">기타</option>
							<!-- 옵션내용 반복 끝 -->
						</select>
					</li>
					<!-- 옵션 반복 끝 -->
				</ul>
			</fieldset>
			
			<div class="actions">
				<h4>이 품목을..</h4>
				<ul>
					<!-- 작업구분이 편집의뢰일때만 -->
					<li class="accept"><a href="### 시안확정 URL ###">시안확정</a></li>
					<li class="edit"><a href="### 편집하기(웹탑)">편집하기</a></li>
					<li class="delete"><a href="javascript:del_mytemp('<%= my.id %>');">삭제</a></li>
					<li class="one-order"><a href="### 주문하기 URL ###">바로 주문하기</a></li>
					<li class="back-list">여러항목을 주문할 경우 바구니 목록에서 주문해주세요.</li>
				</ul>
			</div>
		</div>
	</div>
	<div id="feedback-list">
	<%
		jbbs = Jobboard.all(:user_id => current_user.id, :mytemp_id => my.id, :order => [:created_at.desc]) 
	%>	
		<h4>요청사항/처리 목록</h4>
		<table cellpadding="0" cellspacing="0" border="0">
			
			<thead>
				<tr>
					<th>번호</th>
					<th>구분</th>
					<th>내용</th>
					<th>작성자</th>
					<th>요청날짜</th>
					<th>파일</th>
				</tr>
			</thead>
			
			<tbody id="jbbs_body">
				<!-- 요청사항 표시 반복부분 시작 -->
				<% 
					num = jbbs.count
					jbbs.each do |bbs|
				%>
				<tr>
					<td class="number"><%= num %></td>
					<td class="type"><%= Request_code.first(:code => bbs.feedback_code).name %></td>
					<td class="memo"><a href="### 내용보기 페이지로 ###"><%= bbs.content %></a></td>
					<td class="name"><%= User.get(bbs.user_id).name %></td>
					<td class="date"><%= bbs.updated_at.strftime('%Y-%m-%d') %></td>
					<td class="file"></td>
				</tr>
				<%
						num -= 1
			 		end
				%>
				<!-- 요청사항 표시 반복부분 종료 -->
			</tbody>
		</table>
	</div>
	<form action="### 요청사항 입력 URL ###" method="post" id="feedback-add">
		<fieldset>
			<legend>요청사항 입력</legend>
			<p class="type"><label for="feedback-type">글 구분</label> 
				<% Request_code.all(:gubun.like => '%user%' ).each do |r| %>
				<input name="feedback_code" type="radio" <%= "checked" if r.code == "0" %> value="<%= r.code %>"><%= r.name %>
				<% end %>
			<p class="memo">
				<label for="" id="feedback-memo">요청내용</label>
				<textarea name="content" id="feedback_memo" placeholder="내용을 입력해주세요."></textarea>
			</p>
			<p class="file">
				<label for="" id="feedback-file">파일올리기</label>
				<input type="file" name="### 피드백 파일 ###" id="feedback-file" />
			</p>
			<input id="req_submit" type="button" value="요청사항 접수" class="submit-button"/>
		</fieldset>
	</form>
	<a href="/mytemplates"><img src="/images/content/button-backlist-out.png" alt="목록으로 돌아가기" width="103" height="27" /></a>
</div>